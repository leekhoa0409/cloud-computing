<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kết quả phân tích</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/result.css') }}">
</head>

<body>
  <header>
    <h2 class="mb-2">Kết quả phân tích: {{ filename }}</h2>
    <a href="/" class="text-light">← Phân tích ảnh khác</a>
  </header>
  <div class="container main-container">
    <div class="row g-4">

      <div class="col-lg-5 col-md-12">
        <div id="image-container">
          <img id="main-image"
               src="{{ url_for('static', filename='uploads/' + filename) }}"
               alt="uploaded image">
          <canvas id="overlay-canvas"></canvas>
        </div>
      </div>

      <div class="col-lg-7 col-md-12">
        <div id="labels-section" class="result-card">
          <h5>Detected Labels</h5>
          <div class="content"></div>
        </div>

        <div id="faces-section" class="result-card">
          <h5>Detected Faces</h5>
          <div class="content"></div>
        </div>

        <div id="celebrities-section" class="result-card">
          <h5>Recognized Celebrities</h5>
          <div class="content"></div>
        </div>

        <div id="ppe-section" class="result-card">
          <h5>PPE Detection</h5>
          <div class="content"></div>
        </div>

        <div id="text-section" class="result-card">
          <h5>Detected Text</h5>
          <div class="content"></div>
        </div>

        <div id="moderation-section" class="result-card">
          <h5>Moderation Labels</h5>
          <div class="content"></div>
        </div>

        <div id="compare-section" class="result-card">
          <h5>Compare Faces Result</h5>
          <div class="content"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    window.filename = {{ filename|tojson }};
    window.selectedFeatures = {{ features|tojson if features is defined else "[]" }};
    window.rekognitionData = {{ results | tojson }};
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const selected = window.selectedFeatures || [];
      selected.forEach(feature => {
        const section = document.getElementById(`${feature}-section`);
        if (section) section.classList.add("active");
      });

      if (selected.length === 0) {
        const alert = document.createElement("div");
        alert.className = "no-feature-alert";
        alert.innerHTML = "Bạn chưa chọn tính năng nào, vui lòng chọn 1 và thử lại.";
        document.querySelector(".col-lg-7").prepend(alert);
      }
    });
  </script>

  <script src="{{ url_for('static', filename='js/result.js') }}"></script>
</body>
</html>
